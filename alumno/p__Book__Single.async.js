(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},GRGO:function(e,t,a){e.exports={container:"an-pages-book-single-p-d-f-index-container",document:"an-pages-book-single-p-d-f-index-document"}},HzA4:function(e,t,a){e.exports={comment:"an-pages-book-single-comment-index-comment",showHover:"an-pages-book-single-comment-index-showHover"}},Qge9:function(e,t,a){e.exports={editor:"an-pages-book-single-comment-editor-index-editor"}},UCcr:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),r=(a("+BJd"),a("mr32")),o=(a("/zsF"),a("PArb")),l=(a("5Dmo"),a("3S7+")),c=(a("pC0b"),a("GzdX")),i=a("2Taf"),s=a.n(i),u=a("vZ4D"),m=a.n(u),d=a("l4Ni"),p=a.n(d),h=a("ujKo"),v=a.n(h),g=a("MhPg"),b=a.n(g),E=(a("Pwec"),a("CtXQ")),f=a("q1tI"),y=a.n(f),k=a("MuoO"),C=a("Aeqt"),S=(a("i5XK"),a("jq9l")),w=(a("Telt"),a("Tckk")),_=a("wd/R"),N=a.n(_),x=a("JW7x"),U=a("rmP6"),L=a.n(U),I=(a("91UR"),a("HzA4")),P=a.n(I),T=(a("qVdP"),a("jsC+")),V=(a("lUTK"),a("BvKs")),D=(a("2qtc"),a("kLXV")),A=(a("+L6B"),a("2/Rp")),R=a("Qge9"),z=a.n(R),q={toolbar:[["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],["link","code-block"],["clean"]]},H=function(e){var t=e.onChange,a=e.onSubmit,n=e.value,r=e.currentUser;return y.a.createElement("div",{className:z.a.editor},y.a.createElement(L.a,{value:n,modules:q,onChange:t}),y.a.createElement(A["a"],{htmlType:"submit",onClick:a},"Comentar como ".concat(r.user_name?r.user_name:"")))},J=H,O=function(e){function t(){var e,a;s()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=p()(this,(e=v()(t)).call.apply(e,[this].concat(r))),a.state={value:"",editorVisible:!1,update:!1},a.toggleEditorVisible=function(){a.setState({editorVisible:!a.state.editorVisible,update:!1,value:""})},a.handleSubmitUpdate=function(){if(a.state.value){var e=a.props,t=e.dispatch,n=e.comment;t({type:"comment/update",payload:{body:a.state.value,id:n.id}}),a.setState({value:"",update:!1})}},a.handleSubmit=function(){if(a.state.value){var e=a.props,t=e.dispatch,n=e.comment;t({type:"comment/create",payload:{body:a.state.value,parent_id:n.id}}),a.setState({value:"",editorVisible:!1})}},a.handleVote=function(e){var t=a.props.dispatch;t({type:"comment/vote",payload:{comment_id:e.id,value:1!=e.has_vote}})},a.handleChange=function(e){a.setState({value:e})},a}return b()(t,e),m()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.comment,n=t.currentUser,r=t.setting,o=t.dispatch,c=t.children,i=(t.last,function(){var t=function(t){var n=t.key;switch(n){case"delete":D["a"].confirm({title:"Eliminar",content:"\xbfSeguro que quieres eliminar este comentario?",okText:"Eliminar",okType:"danger",onOk:function(){o({type:"comment/delete",payload:{id:a.id}})}});break;case"update":e.setState({update:!0,editorVisible:!1,value:a.body});break;default:break}},r=y.a.createElement(V["a"],{onClick:t},y.a.createElement(V["a"].Item,{key:"update",disabled:a.user[0].id!==n.id},y.a.createElement(E["a"],{type:"edit"}),"Editar"),y.a.createElement(V["a"].Item,{key:"delete",disabled:a.user[0].id!==n.id},y.a.createElement(E["a"],{type:"delete"}),"Eliminar"));return[y.a.createElement("span",null,y.a.createElement(l["a"],{title:"Like"},y.a.createElement(E["a"],{type:"like",theme:1===a.has_vote?"filled":"outlined",onClick:function(){return e.handleVote(a)}})),y.a.createElement("span",{style:{paddingLeft:8,cursor:"auto"}},a.votes)),y.a.createElement("span",{onClick:e.toggleEditorVisible},"Responder"),y.a.createElement("span",{className:P.a.showHover},y.a.createElement(l["a"],{title:"Editar o eliminar esto"},y.a.createElement(T["a"],{overlay:r,trigger:["click"]},y.a.createElement(E["a"],{type:"dash"}))))]});return y.a.createElement(f["Fragment"],null,y.a.createElement(S["a"],{key:a.id,className:P.a.comment,content:this.state.update?y.a.createElement(J,{onChange:this.handleChange,onSubmit:this.handleSubmitUpdate,value:this.state.value,currentUser:n}):y.a.createElement("div",{dangerouslySetInnerHTML:{__html:a.body}}),author:a.user[0].user_name,avatar:""==a.user[0].avatar?"".concat(C["b"].path,"/").concat(r.logo):"".concat(C["b"].path,"/").concat(a.user[0].avatar),actions:i(),datetime:y.a.createElement(l["a"],{title:N()(a.created_at).subtract(1,"seconds").format("LLLL")},y.a.createElement("span",null,N()(a.created_at).subtract(1,"seconds").fromNow()))},c),this.state.editorVisible&&y.a.createElement(S["a"],{avatar:""==n.avatar?"".concat(C["b"].path,"/").concat(r.logo):"".concat(C["b"].path,"/").concat(n.avatar),content:y.a.createElement(J,{onChange:this.handleChange,onSubmit:this.handleSubmit,value:this.state.value,currentUser:n})}))}}]),t}(y.a.Component),j=O,M=function(e){function t(){var e,a;s()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=p()(this,(e=v()(t)).call.apply(e,[this].concat(r))),a.state={value:""},a.handleData=function(e){var t=a.props,n=t.dispatch,r=t.currentItem,o=JSON.parse(e);if(o.data.book_id==r.id)switch(o.type){case"create":n({type:"comment/addItem",payload:o.data});break;case"update":n({type:"comment/updateItem",payload:o.data});break;case"delete":n({type:"comment/deleteItem",payload:o.data});break;default:break}},a.handleSubmit=function(){if(a.state.value){var e=a.props.dispatch;e({type:"comment/create",payload:{body:a.state.value}}),a.setState({value:""})}},a.handleVote=function(e){var t=a.props.dispatch;t({type:"comment/vote",payload:{comment_id:e.id,value:1!=e.has_vote}})},a.handleChange=function(e){a.setState({value:e})},a.renderCommentList=function(e,t,n,r){return e.map(function(o,l){var c=l+1==e.length;return o.children?y.a.createElement(j,{key:o.id,dispatch:t,currentUser:n,setting:r,last:c,comment:o},a.renderCommentList(o.children,t,n,r)):y.a.createElement(j,{key:o.id,dispatch:t,currentUser:n,setting:r,last:c,comment:o})})},a}return b()(t,e),m()(t,[{key:"render",value:function(){var e=this.props,t=e.comment,a=e.currentUser,n=e.setting,r=(e.submitting,e.dispatch);return y.a.createElement("div",null,y.a.createElement(x["a"],{url:"".concat(C["b"].socket,"/comment"),onMessage:this.handleData}),this.renderCommentList(t.list,r,a,n),y.a.createElement(S["a"],{avatar:y.a.createElement(w["a"],{src:""==a.avatar?"".concat(C["b"].path,"/").concat(n.logo):"".concat(C["b"].path,"/").concat(a.avatar),alt:a.full_name}),content:y.a.createElement(J,{onChange:this.handleChange,onSubmit:this.handleSubmit,value:this.state.value,currentUser:a})}))}}]),t}(y.a.Component),G=function(e){var t=e.comment,a=e.book,n=e.global,r=e.loading;return{comment:t,currentItem:a.currentItem,currentUser:n.user,setting:n.setting,submitting:r.effects["book/create"]}},K=Object(k["connect"])(G)(M),Q=(a("T2oS"),a("W9HT")),B=(a("DjyN"),a("NUBc")),X=a("UsKZ"),W=a("GRGO"),F=a.n(W),Z=function(e){function t(){var e,a;s()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=p()(this,(e=v()(t)).call.apply(e,[this].concat(r))),a.state={numPages:null,pageNumber:1,loadSuccess:!1},a.onDocumentLoadSuccess=function(e){var t=e.numPages;a.setState({numPages:t,loadSuccess:!0})},a.onChange=function(e,t){a.setState({pageNumber:e})},a.onDownload=function(){a.props.data},a}return b()(t,e),m()(t,[{key:"render",value:function(){var e=this.props.data,t=this.state;t.pageNumber,t.numPages;return void 0!=e.pdf?y.a.createElement("div",{className:F.a.container},this.state.loadSuccess&&y.a.createElement(B["a"],{total:this.state.numPages,size:"small",className:F.a.pagination,defaultPageSize:1,current:this.state.pageNumber,showQuickJumper:!0,showTotal:function(e){return"Total ".concat(e," P\xe0ginas")},onChange:this.onChange}),"pdf"==e.pdf.slice(-3).toLocaleLowerCase()&&y.a.createElement("div",{className:F.a.document},y.a.createElement(X["Document"],{file:"".concat(C["b"].path,"/").concat(e.pdf),loading:y.a.createElement(Q["a"],null),onLoadSuccess:this.onDocumentLoadSuccess},y.a.createElement(X["Page"],{pageNumber:this.state.pageNumber,width:600}))),this.state.loadSuccess&&y.a.createElement(B["a"],{total:this.state.numPages,size:"small",className:F.a.pagination,defaultPageSize:1,current:this.state.pageNumber,showQuickJumper:!0,showTotal:function(e){return"Total ".concat(e," P\xe0ginas")},onChange:this.onChange}),e.enable_download&&this.state.loadSuccess&&y.a.createElement(A["a"],{icon:"cloud-download",type:"primary",size:"large",onClick:this.onDownload,style:{marginTop:"24px"}},"Descargar")):y.a.createElement("span",null)}}]),t}(f["Component"]),Y=Z,$=function(e){var t=e.type,a=e.text;return y.a.createElement("span",null,y.a.createElement(E["a"],{type:t,style:{marginRight:8}}),a)},ee=function(e){function t(){var e,a;s()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=p()(this,(e=v()(t)).call.apply(e,[this].concat(r))),a.onRateChange=function(e){var t=a.props,n=t.dispatch;t.book.currentItem;n({type:"book/like",payload:e})},a.renderStarts=function(e){var t=e.detail.starts,n=t.map(function(e,t){return y.a.createElement("div",{key:t},"".concat(e.user_name," \u2605 ").concat(e.stars))});return y.a.createElement("div",null,y.a.createElement(c["a"],{value:e.detail.start_value,onChange:function(t){return a.onRateChange({stars:t,book_id:e.id})}}),y.a.createElement(l["a"],{title:n},y.a.createElement("span",null,t.length)))},a}return b()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.match,a=e.dispatch;a({type:"book/byId",payload:parseInt(t.params.id)}),a({type:"comment/all",payload:{book_id:parseInt(t.params.id)}})}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"book/resetbook"})}},{key:"render",value:function(){var e=this.props.book,t=e.currentItem;return console.log(t,"CURRENT"),y.a.createElement(n["a"],null,y.a.createElement("div",{style:{textAlign:"center"}},y.a.createElement("h1",null,t.name),y.a.createElement("p",null,t.long_description)),y.a.createElement(Y,{data:t}),y.a.createElement(o["a"],null),y.a.createElement("span",null,y.a.createElement($,{type:"user",text:y.a.createElement("span",null,"Autor: ",y.a.createElement(r["a"],null,t.author))}),y.a.createElement(o["a"],{type:"vertical"}),y.a.createElement($,{type:"book",text:y.a.createElement("span",null,"Editorial: ",y.a.createElement(r["a"],null,t.editorial))}),y.a.createElement(o["a"],{type:"vertical"}),y.a.createElement($,{type:"tag",text:y.a.createElement("span",null,"Versi\xf3n: ",y.a.createElement(r["a"],null,t.version))}),y.a.createElement(o["a"],{type:"vertical"}),y.a.createElement($,{type:"global",text:y.a.createElement("span",null,"A\xf1o edici\xf3n: ",y.a.createElement(r["a"],null,t.year_edition))})),y.a.createElement(o["a"],null),y.a.createElement("span",null,t.id&&this.renderStarts(t),y.a.createElement(o["a"],{type:"vertical"}),y.a.createElement($,{type:"read",text:t.views}),y.a.createElement(o["a"],{type:"vertical"})),y.a.createElement(o["a"],null),y.a.createElement(K,null))}}]),t}(f["Component"]),te=function(e){var t=e.book,a=e.loading;return{book:t,loading:a.effects["book/all"]}};t["default"]=Object(k["connect"])(te)(ee)}}]);